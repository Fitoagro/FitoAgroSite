<!DOCTYPE html>

<html>

<head>
	<meta charset=utf-8 />
	<title>Informação da visita</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<script src="https://kit.fontawesome.com/16512b04b3.js" crossorigin="anonymous"></script>

	<script src='https://api.mapbox.com/mapbox.js/v3.3.0/mapbox.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/v3.3.0/mapbox.css' rel='stylesheet' />

	<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		  integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>

<div class="header">
	<img src="resources/images/fitoagro_logo.png" onclick="window.location.href = 'index.html'" style="height: 50px; align-self: center; cursor: pointer">
	<div style="margin-left: auto; align-self: center">
		<!--Add buttons to initiate auth sequence and sign out-->
		<div id="user_name"> </div>
		<button onclick="handleSignoutClick()" type="button" class="btn light-button" style="background-color: lightgray; color: black; display: inline-block; float: right;  " id="signout_button">Logout</button>
	</div>
</div>

<div style=" display: inline; height: 50px; width:50px; position: sticky; top: 150px; left: 3%; z-index: 2; cursor: pointer">
	<i class="fas fa-arrow-circle-left" style="font-size: 50px; color: #00574B;margin-top: 30px" onclick="window.history.back()"></i>
</div>

<div id="info" style="display: flex; flex-direction: row; overflow-x: hidden; overflow-y: scroll;">


	<div class="row" style="height: inherit; padding: 16px 16px 0 48px;">

		<div style=" height: 100%; display: flex; flex-direction: row">
			<div style="flex-direction: column; width: fit-content; padding-right: 64px;">

				<h1 id="plot_name" ></h1>

				<br>
				<div style="display: flex; flex-direction: row; align-items: baseline;">
					<i class="fas fa-camera" style="font-size: 20px; color: #008577"></i>
					&nbsp;&nbsp;
					<a id="number_photos" style="font-size: 20px"></a>

					<i class="fas fa-microphone" style="margin-left: 20px; font-size: 20px; color: #008577"></i>
					&nbsp;&nbsp;
					<a id="number_voice_records" style="font-size: 20px"></a>
				</div>
				<br><br>

				<a id="begin_text" style="font-weight: bold; font-size: 22px; color: #008577">Início:</a>
				&nbsp;&nbsp;
				<a id="begin"></a>

				<br><br>

				<a id="duration_text" style="font-weight: bold; font-size: 22px; color: #008577">Duração:</a>
				&nbsp;&nbsp;
				<a id="duration"></a>

				<br>
				<br>

				<div  id="note_gallery">
					<a style="font-weight: bold; font-size: 22px; color: #008577"> Notas: </a>
					&nbsp;&nbsp;
					<a id="no_notes"> Sem notas. </a>
					<ul id= "notes_ul"/>
				</div>
				<div id='notes' style="display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-end">
					<textarea placeholder="Adicionar notas..." id="note" rows="4" cols="50"></textarea>
					<button class="btn light-button" style="margin-top:6px;width: fit-content; background-color: lightgrey; color: #00574B" id="add_note">Submeter <i class="fas fa-paper-plane"></i></button>
				</div>


			</div>

			<div class="column">

				<div id="map" style="margin-top: 16px;"></div>
				<div id="menu">
					<input
							id="streets-v11"
							type="radio"
							name="rtoggle"
							value="streets"/>
					<label for="streets">streets</label>
					&nbsp;&nbsp;
					<input id="light-v10" type="radio" name="rtoggle" value="light" />
					<label for="light">light</label>
					&nbsp;&nbsp;
					<input id="dark-v10" type="radio" name="rtoggle" value="dark" />
					<label for="dark">dark</label>
					&nbsp;&nbsp;
					<input id="outdoors-v11" type="radio" name="rtoggle" value="outdoors" />
					<label for="outdoors">outdoors</label>
					&nbsp;&nbsp;
					<input id="satellite-v9" type="radio" name="rtoggle" value="satellite"
						   checked="checked" />
					<label for="satellite">satellite</label>
				</div>
			</div>


		</div>

		<div id="gallery" class="column" style=" display: none; width: 100%; margin-top: 48px">

			<div  class="gallery" id="photo_gallery" >
				<p style="font-weight: bold; font-size: 22px; color: #008577"> Fotografias </p>
			</div>

			<br>

			<div  class="gallery" id="audio_gallery">
				<p style="font-weight: bold; font-size: 22px; color: #008577"> Anotações Vocais </p>
			</div>
		</div>
	</div>
</div>

<script type='text/javascript'>


	mapboxgl.accessToken = 'pk.eyJ1IjoibWlndWVsYXNjb3JyZWlhIiwiYSI6ImNrN25iYzh4NTAxMHIzc210bzJpM3EyZDcifQ.pVWzek_lEMfJixSnBu1ZMA';

	var CLIENT_ID = '697021054229-c7jjbfpfmjkrnoqjo2pg7nfj7v1a1f95.apps.googleusercontent.com';
	var API_KEY = 'AIzaSyCMSb0abab-1ALwctezS4mWo8AalLXI9KI';

	var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
	var SCOPES = 'https://www.googleapis.com/auth/drive';

	/**
	 *  Sign out the user upon button click.
	 */
	function handleSignoutClick() {
		gapi.auth2.getAuthInstance().signOut();
		window.location.href = 'index.html';
	}

	var mFocus;
	var mPoints;
	var mPlot;
	var noteFolder = '';
	var imageFolder = '';
	var audioFolder = '';
	var userName = '';

	var files_map = {};

	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/satellite-v9',
		zoom: 0
	});


	var layerList = document.getElementById('menu');
	var inputs = layerList.getElementsByTagName('input');
	var user = document.getElementById('user_name');

	function switchLayer(layer) {
		var layerId = layer.target.id;
		map.setStyle('mapbox://styles/mapbox/' + layerId);
		map.on('style.load', function() {
			reloadMap();


		});
	}

	for (var i = 0; i < inputs.length; i++) {
		inputs[i].onclick = switchLayer;
	}



	var input = document.getElementById('note');
	var button = document.getElementById('add_note');

	button.onclick = function(){
		var text = input.value;
		if(text == null || text == "")
			alert("Campo obrigatório");
		else{

			function pad2(n) { return n < 10 ? '0' + n : n }

			var date = new Date();

			var name = date.getFullYear().toString() + pad2(date.getMonth() + 1) + pad2( date.getDate()) + pad2( date.getHours() ) + pad2( date.getMinutes() ) + pad2( date.getSeconds() );

			text = userName + " ("+ pad2( date.getDate()) + "/" + pad2(date.getMonth() + 1) + "/" +  date.getFullYear().toString() + " " + pad2( date.getHours() )+ ":" + pad2( date.getMinutes() ) + '): ' + text;


			var file = new Blob([text], {type: 'text/plain'});

			var accessToken = gapi.auth.getToken().access_token;

			var form = new FormData();


			if(noteFolder == ''){
				var folderId = getUrlVars()['visit_id'];


				var request = gapi.client.drive.files.create({
					"name" : "Notes",
					"mimeType" : "application/vnd.google-apps.folder",
					"parents" : [folderId],
				});

				request.execute(function(resp) {
					noteFolder = resp.id;

					var metadata = {
						"name" : name,
						"mimeType" : "text/plain",
						"parents" : [noteFolder],
					};

					form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
					form.append('file', file);

					var xhr = new XMLHttpRequest();
					xhr.open('post', 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id');
					xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
					xhr.responseType = 'json';
					xhr.onload = () => {
						var a = document.getElementById("no_notes");
						a.innerHTML = "";
						var ul = document.getElementById("notes_ul");
						var li = document.createElement('li');
						ul.appendChild(li);
						li.innerHTML=li.innerHTML + text;
					};
					xhr.send(form);

				});
			}else{
				var metadata = {
					"name" : name,
					"mimeType" : "text/plain",
					"parents" : [noteFolder],
				};

				form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
				form.append('file', file);

				var xhr = new XMLHttpRequest();
				xhr.open('post', 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id');
				xhr.setRequestHeader('Authorization', 'Bearer ' + accessToken);
				xhr.responseType = 'json';
				xhr.onload = () => {
					var a = document.getElementById("no_notes");
					a.innerHTML = "";
					var ul = document.getElementById("notes_ul");
					var li = document.createElement('li');
					ul.appendChild(li);
					li.innerHTML=li.innerHTML + text;
				};
				xhr.send(form);
			}

			input.value = '';
		}
	}



	function reloadMap(){

		if(map.getLayer('plot'))
			map.removeLayer('plot')

		if(map.getLayer('route'))
			map.removeLayer('route')


		if(!map.getSource('plot'))
			map.addSource('plot', {
				'type': 'geojson',
				'data': {
					'type': 'Feature',
					'geometry': {
						'type': 'Polygon',
						'coordinates': mPlot
					}
				}
			});

		if(!map.getSource('route'))

			map.addSource('route', {
				'type': 'geojson',
				'data': {
					'type': 'Feature',
					'properties': {},
					'geometry': {
						'type': 'LineString',
						'coordinates': mPoints
					}
				}
			});

		map.addLayer({
			'id': 'plot',
			'type': 'fill',
			'source': 'plot',
			'layout': {},
			'paint': {
				'fill-color': '#55C93D',
				'fill-opacity': 0.4
			}
		});

		map.addLayer({
			'id': 'route',
			'type': 'line',
			'source': 'route',
			'layout': {
				'line-join': 'round',
				'line-cap': 'round'
			},
			'paint': {
				'line-color': '#e55e5e',
				'line-width': 6
			}
		});
	}




	function readTextFile(file, callback) {
		var rawFile = new XMLHttpRequest();
		rawFile.overrideMimeType("application/json");
		rawFile.open("GET", file, true);
		rawFile.onreadystatechange = function() {
			if (rawFile.readyState === 4 && rawFile.status == "200") {
				callback(rawFile.responseText);
			}
		}
		rawFile.send(null);
	}


	function handleClientLoad() {
		gapi.load('client:auth2', initClient);
	}


	function initClient() {
		gapi.client.init({
			apiKey: API_KEY,
			clientId: CLIENT_ID,
			discoveryDocs: DISCOVERY_DOCS,
			scope: SCOPES
		}).then(function () {
			// Listen for sign-in state changes.
			gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

			// Handle the initial sign-in state.
			updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
		}, function(error) {
			appendPre(JSON.stringify(error, null, 2));
		});
	}

	function updateSigninStatus(isSignedIn) {
		auth2 = gapi.auth2.getAuthInstance();
		if (isSignedIn) {
			var profile = auth2.currentUser.get().getBasicProfile();
			userName = profile.getName();
			user.innerHTML = userName;
			user.style.display = 'inline-block';
			listFolder();
		}
	}

	//		  function appendPre(message) {
	//			var pre = document.getElementById('content');
	//			var textContent = document.createTextNode(message + '\n');
	//			pre.appendChild(textContent);
	//		  }

	function getUrlVars() {
		var vars = {};
		var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
			vars[key] = value;
		});
		return vars;
	}

	function loadMap(toFocus,plot){
		this.mFocus = toFocus;
		this.mPlot = plot;

		map.flyTo({ center: toFocus, zoom: 16, speed: 10. });

		var layers = map.getStyle().layers;

		var found = false;
		var layerIds = layers.map(function (layer) {
			if(layer.id == 'route')
				found = true;
		});


		map.addSource('plot', {
			'type': 'geojson',
			'data': {
				'type': 'Feature',
				'geometry': {
					'type': 'Polygon',
					'coordinates': plot
				}
			}
		});
		if(found)
			map.addLayer({
				'id': 'plot',
				'type': 'fill',
				'source': 'plot',
				'layout': {},
				'paint': {
					'fill-color': '#55C93D',
					'fill-opacity': 0.4
				}
			},'route');
		else

			map.addLayer({
				'id': 'plot',
				'type': 'fill',
				'source': 'plot',
				'layout': {},
				'paint': {
					'fill-color': '#55C93D',
					'fill-opacity': 0.4
				}
			});

	}


	function addRoute(points, wayPoints){
		this.mPoints = points;

		for(var i = 0 ; i < wayPoints.length; i++){
			var el = document.createElement('div');
			var popup;

			if(wayPoints[i][0].type > 0){
				el.className = 'marker_voice';
				popup = new mapboxgl.Popup({ offset: 25 })
						.setHTML('<a href="https://drive.google.com/uc?export=view&id=' + files_map[wayPoints[i][0].name] +'" target=' + wayPoints[i][0].name + '>' + wayPoints[i][0].name + '</a>');
			}
			else{
				el.className = 'marker_image';
				popup = new mapboxgl.Popup({ offset: 25 })
						.setHTML('<a href="https://drive.google.com/uc?export=view&id=' + files_map[wayPoints[i][0].name] + '" target=' + wayPoints[i][0].name + '>' + wayPoints[i][0].name + '</a>');
			}


			var point = [wayPoints[i][0].longitude, wayPoints[i][0].latitude];

			new mapboxgl.Marker(el)
					.setLngLat(point)
					.setPopup(popup)
					.addTo(map);

		}


		map.addSource('route', {
			'type': 'geojson',
			'data': {
				'type': 'Feature',
				'properties': {},
				'geometry': {
					'type': 'LineString',
					'coordinates': points
				}
			}
		});
		map.addLayer({
			'id': 'route',
			'type': 'line',
			'source': 'route',
			'layout': {
				'line-join': 'round',
				'line-cap': 'round'
			},
			'paint': {
				'line-color': '#e55e5e',
				'line-width': 6
			}
		});
	}

	function msToTime(s) {

		function pad(n, z) {
			z = z || 2;
			return ('00' + n).slice(-z);
		}

		var ms = s % 1000;
		s = (s - ms) / 1000;
		var secs = s % 60;
		s = (s - secs) / 60;
		var mins = s ;
		//var hrs = (s - mins) / 60;

		if(mins === 0){
			return pad(secs) + " segundos";
		}else
			return mins + " minutos";
		//return pad(hrs) + ':' + pad(mins) + ':' + pad(secs);
	}



	function getGPX(id){
		gapi.client.drive.files.get({
			'fileId': id,
			'alt': 'media',
		}).then(function(response) {
			var gpx = response.body;
			var trk = gpx.substring(
					gpx.lastIndexOf("<trkseg>") + 8,
					gpx.lastIndexOf("</trkseg>")
			);



			var arrayOfLines = trk.match(/[^\r\n]+/g);
			var points = [];

			for(var w = 0; w < arrayOfLines.length; w++){
				var line = arrayOfLines[w];
				var lat = line.substring(
						line.lastIndexOf('<trkpt lat="') + 12,
						line.lastIndexOf('" lon="')
				);
				var ln = line.substring(
						line.lastIndexOf('lon="') + 5,
						line.lastIndexOf('"><time>')
				);

				var point = [];
				point.push(parseFloat(ln));
				point.push(parseFloat(lat));
				points.push(point);

			}

			var wayPoints = [];

			var wpts  = gpx.substring(
					gpx.indexOf("<wpt "),
					gpx.lastIndexOf("</wpt>")
			);
			var wpts_array = wpts.split("<wpt ");
			for(var k = 0 ; k < wpts_array.length ;k ++){
				var line = wpts_array[k];
				if(line != ""){
					var file_name = line.substring(
							line.lastIndexOf('<name>') + 6,
							line.lastIndexOf('</name>')
					);
					var lat = line.substring(
							line.lastIndexOf('lat="') + 5,
							line.lastIndexOf('" lon="')
					);
					var ln = line.substring(
							line.lastIndexOf('lon="') + 5,
							line.lastIndexOf('"><time>')
					);

					var waypoint = [];
					var file_type;
					if(file_name.includes("photo"))
						file_type = 0;
					else
						file_type = 1;

					var file = {type:file_type, name:file_name, longitude:parseFloat(ln), latitude:parseFloat(lat)};

					waypoint.push(file);
					wayPoints.push(waypoint);
				}


			}

			addRoute(points,wayPoints);


		});
	}

	function getVisitJSON(id){
		gapi.client.drive.files.get({
			'fileId': id,
			'alt': 'media',
		}).then(function(response) {
			var json =  JSON.parse(response.body); //response.body contains the string value of the file
			var plot_id = json['plot_id'];
			var plots_jsons;
			readTextFile("resources/json/parcelas.json", function(text){
				plots_jsons = JSON.parse(text);

				for(var j = 0; j < plots_jsons.features.length; j++){
					var idparcela = plots_jsons.features[j].properties['idparcela'];
					if(idparcela == plot_id){


						document.getElementById('plot_name').innerHTML = plots_jsons.features[j].properties['nomeparcela'];

						document.getElementById('number_photos').innerHTML = json['number_photos'];

						document.getElementById('number_voice_records').innerHTML = json['number_voice_records'];

						var begin = json['time_begin'].replace('_','');
						var end = json['time_end'].replace('_','');

						var year = begin.substring(0,4);
						var month = begin.substring(4,6);
						var day = begin.substring(6,8);
						var hour = begin.substring(8,10);
						var min = begin.substring(10,12);

						document.getElementById('begin').innerHTML = day +'/' + month + '/' + year + ' ' + hour + ':' + min



						var begin_date = new Date(begin.replace(
								/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)$/,
								'$4:$5:$6 $2/$3/$1'
						));

						var end_date = new Date(end.replace(
								/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)$/,
								'$4:$5:$6 $2/$3/$1'
						));

						var difference = end_date - begin_date;

						document.getElementById('duration').innerHTML = msToTime(difference);

						document.getElementById("info").style.visibility = "visible";

						var coordinates =  plots_jsons.features[j].geometry.coordinates;
						var toFocus = coordinates[0][0];
						loadMap(toFocus, coordinates);
						break;
					}
				}
				//data.features[0].geometry
			});

		});
	}


	function getPhotos(id){
		gapi.client.drive.files.list({
			'folderId' : id,
			'pageSize': 100,
			'fields': "nextPageToken, files(id, name)",
			'q': `'${id}' in parents`
		}).then(function(response) {
			var files = response.result.files;
			if (files && files.length > 0) {
				var div = document.getElementById("photo_gallery");
				div.style.display = "block";
				for(var i = 0; i < files.length; i++){

					files_map[files[i].name] = files[i].id;

					/*	gapi.client.drive.files.get({
							'fileId': files[i].id,
							'alt': 'media',
						}).then(function(response) {
							var b64Response = btoa(response.body);

							var outputImg = document.createElement('img');
							outputImg.src = 'data:image/png;base64,'+b64Response;

							document.body.appendChild(outputImg);
						});*/

					var name = files[i].name.substring(6,files[i].name.length).replace('_','');

					var year = name.substring(0,4);
					var month = name.substring(4,6);
					var day = name.substring(6,8);
					var hour = name.substring(8,10);
					var min = name.substring(10,12);


					var title = day + "/" + month + "/" + year + " " + hour + ":" + min;

					var image_container = document.createElement('a');
					image_container.href = 'https://drive.google.com/uc?export=view&id=' + files[i].id;
					image_container.target = files[i].name;
					image_container.rel = "noopener nore";
					var img = document.createElement('img');
					img.src = 'https://drive.google.com/uc?export=view&id=' + files[i].id;
					img.setAttribute( "class", 'image_thumbnail');

					var figcaption = document.createElement('figcaption');
					figcaption.setAttribute( "class", 'image_caption');
					figcaption.innerHTML = title;

					var figure = document.createElement('figure');
					figure.appendChild(img);
					figure.appendChild(figcaption);

					image_container.appendChild(img);
					div.appendChild(image_container);
				}
			}

		});
	}

	function getAudios(id){
		gapi.client.drive.files.list({
			'folderId' : id,
			'pageSize': 100,
			'fields': "nextPageToken, files(id, name)",
			'q': `'${id}' in parents`
		}).then(function(response) {
			var files = response.result.files;
			if (files && files.length > 0) {
				var div = document.getElementById("audio_gallery");

				div.style.display = "block"

				for(var i = 0; i < files.length; i++){
					files_map[files[i].name] = files[i].id;

					/*	gapi.client.drive.files.get({
							'fileId': files[i].id,
							'alt': 'media',
						}).then(function(response) {
							var b64Response = btoa(response.body);

							var outputImg = document.createElement('img');
							outputImg.src = 'data:image/png;base64,'+b64Response;

							document.body.appendChild(outputImg);
						});*/

					var a = document.createElement('a');
					var br1 = document.createElement('br');
					var br2 = document.createElement('br');
					var br3 = document.createElement('br');

					var name = files[i].name.split("_");

					var day = name[name.length -2];
					var year = day.substring(0,4);
					var month  = day.substring(4,6);
					var day_of_month  = day.substring(6,8);

					var time = name[name.length -1];
					var hour = time.substring(0,2);
					var minutes = time.substring(2,4);

					a.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;" + day_of_month + "/" + month + "/" + year + " " + hour + ":" + minutes;


					var audio = document.createElement('audio');
					audio.id       = 'audio-player';
					audio.controls = 'controls';
					audio.src      = 'https://drive.google.com/uc?export=download&id=' + files[i].id;
					audio.type     = 'audio/mp3';

					div.appendChild(a);
					div.appendChild(br1);
					div.appendChild(audio);
					div.appendChild(br2);
					div.appendChild(br3);


				}
			}

		});
	}



	function getNotes(id){
		gapi.client.drive.files.list({
			'folderId' : id,
			'pageSize': 100,
			'fields': "nextPageToken, files(id, name)",
			'q': `'${id}' in parents`
		}).then(function(response) {
			var files = response.result.files;
			if (files && files.length > 0) {
				var a = document.getElementById("no_notes");
				a.innerHTML = "";
				var div = document.getElementById("note_gallery");
				var ul = document.getElementById("notes_ul");
				for(var i = 0; i < files.length; i++){
					gapi.client.drive.files.get({
						'fileId': files[i].id,
						'alt': 'media',
					}).then(function(response) {
						var li = document.createElement('li');
						ul.appendChild(li);
						li.innerHTML=li.innerHTML + response.body;

					});
				}
			}
		});
	}

	function appendPre(message) {
		var pre = document.getElementById('content');
		var textContent = document.createTextNode(message + '\n');
		pre.appendChild(textContent);
	}

	function listFolder() {
		var fileId = getUrlVars()['visit_id'];
		var json_id = '';
		var gpx_id = '';
		var photo_id = '';
		var audio_id = '';

		gapi.client.drive.files.list({
			'folderId' : fileId,
			'pageSize': 100,
			'fields': "nextPageToken, files(id, name)",
			'q': `'${fileId}' in parents`
		}).then(function(response) {
			var files = response.result.files;
			if (files && files.length > 0) {
				for(var i = 0; i < files.length; i++){

					var id = files[i].id

					if(files[i].name.includes('json')){
						json_id = id;
						//getVisitJSON(id);
					}
					else if(files[i].name.includes('gpx')){
						gpx_id = id;
						//getGPX(files[i].id);
					}
					else if(files[i].name == 'Photos'){
						photo_id = id;
						//getPhotos(files[i].id);
					}
					else if(files[i].name == 'Audio'){
						audio_id = id;
						//getAudios(files[i].id);

					}
					else if(files[i].name == 'Notes'){
						//getNotes(files[i].id);
						noteFolder = files[i].id;
					}
				}
				if(noteFolder != '')
					getNotes(noteFolder)
				if(photo_id != '')
					getPhotos(photo_id);
				if(audio_id != '')
					getAudios(audio_id);
				if(json_id != '')
					getVisitJSON(json_id);
				if(gpx_id != '')
					getGPX(gpx_id);

				if(photo_id != '' || audio_id != '')
					document.getElementById("gallery").style.display = "block";

			} else {
				appendPre('No files found.');
			}
		});
	}

</script>

<script async defer src="https://apis.google.com/js/api.js"
		onload="this.onload=function(){};handleClientLoad()"
		onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>


</body>


</html>
