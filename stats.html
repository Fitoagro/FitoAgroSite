<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Estatísticas</title>
    <script type='text/javascript' src='https://prod-uk-a.online.tableau.com/javascripts/api/viz_v1.js'></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="header">
        <img src="resources/images/fitoagro_logo.png" style="height: 40px; padding-bottom: 4px; align-self: center; margin-right: 64px">
        <div id="visits_tab" onclick="window.location.href = 'index.html'" style="cursor:pointer; margin-right: 20px; padding:6px; font-size: 16px; color: white">Visitas</div>
        <!--<div id="analytic_tab" onclick="window.location.href = 'analytic_viz.html'" style="cursor:pointer; margin-right: 20px; padding:6px; font-size: 16px; color: white">Analítica das Observações</div>-->
        <div id="stats_tab" onclick="window.location.reload()" style="cursor:pointer; padding:6px; font-size: 16px; text-decoration: underline; color: white">Estatísticas</div>
        <div style="margin-left: auto; align-self: center">
            <!--Add buttons to initiate auth sequence and sign out-->
            <div id="user_name" style="font-size: 16px; padding-top: 6px; color: #cccccc"> </div>
            <button onclick="handleSignoutClick()" type="button" class="btn light-button" style="background-color: lightgray; color: black; float: right;" id="signout_button">Logout</button>
        </div>
    </div>
        <div class='tableauPlaceholder' style='width: 1450px; height: 960px; overflow-y: scroll; margin: 32px; padding-top: 60px'>
            <object class='tableauViz' width='98%' height='960' style='display:none;'>
                <param name='host_url' value='https%3A%2F%2Fprod-uk-a.online.tableau.com%2F' />
                <param name='embed_code_version' value='3' />
                <param name='site_root' value='&#47;t&#47;tableauforteachingandresearchatnova' />
                <param name='name' value='AnaliticadosDadosdeCampo&#47;Estatsticas' />
                <param name='tabs' value='no' />
                <param name='toolbar' value='no' />
                <param name='showAppBanner' value='false' />
            </object>
        </div>

    <script type="text/javascript">


        var CLIENT_ID = '683847325816-66urtf71ciqlbrjp8dqks5v4nmoks9ih.apps.googleusercontent.com';
        var API_KEY = 'AIzaSyDid5jJUjIBp7BCKZwR1LI0G87b4yEBAhY';

        var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        var SCOPES = 'https://www.googleapis.com/auth/drive';

        var userName = '';
        var user = document.getElementById('user_name');

        let tokenClient;
        let token;
        let gapiInited = false;
        let gisInited = false;

        function gisLoaded(){
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                prompt: 'none',
                callback: '', //defined in handleAuth(),
            });
            gisInited = true;
        }

        /**
         * Callback after api.js is loaded.
         */
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        /**
         * Callback after the API client is loaded. Loads the
         * discovery doc to initialize the API.
         */
        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: DISCOVERY_DOCS,
            });
            gapiInited = true;
            await handleAuth();
        }

        async function handleAuth() {
            if (gapiInited && gisInited) {
                token = sessionStorage.getItem("token");
                if (token !== undefined) {
                    gapi.client.setToken(JSON.parse(token));
                } else {
                    tokenClient.callback = async (tokenResponse) => {
                        if (tokenResponse.error !== undefined) {
                            throw (tokenResponse.error);
                        }
                        document.getElementById('signout_button').style.visibility = 'visible';
                        token = tokenResponse;
                        gapi.client.setToken(tokenResponse);
                        sessionStorage.setItem("token", JSON.stringify(tokenResponse));
                    }

                    if (gapi.client.getToken() === null) {
                        // Prompt the user to select a Google Account and ask for consent to share their data
                        // when establishing a new session.
                        tokenClient.requestAccessToken({prompt: 'select_account'});
                    } else {
                        // Skip display of account chooser and consent dialog for an existing session.
                        tokenClient.requestAccessToken({prompt: 'none'});
                    }
                }
            }
        }

        /**
         *  Sign out the user upon button click.
         */
        /**
         *  Sign out the user upon button click.
         */
        function handleSignoutClick() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                sessionStorage.removeItem("token");
                document.getElementById("renderList").innerHTML = "";
                document.getElementById('visits').innerHTML = "";
                //document.getElementById('visits').removeChild('h3');
                visits = [];
                plots = [];
            }
        }

        function updateSigninStatus(isSignedIn) {
            auth2 = gapi.auth2.getAuthInstance();
            if (isSignedIn) {
                var profile = auth2.currentUser.get().getBasicProfile();
                userName = profile.getName();
                user.innerHTML = userName;
                user.style.display = 'inline-block';
            }else
                window.location.href = "index.html";
        }

    </script>

    <!-- GOOGLE CLIENT -->
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

</body>
</html>



